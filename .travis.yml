language: python
python:
  - "2.7"
  - "3.5"
  - "3.6"
# command to install dependencies
before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y ffmpeg
  - sudo apt-get install  -y imagemagick
  - mkdir media
  - export $MAGICK_CONFIGURE_PATH
  - mkdir -p $HOME/.config/ImageMagick
  - cp /etc/ImageMagick/policy.xml $HOME/.config/ImageMagick/policy.xml
  - sudo rm -rf /etc/ImageMagick/policy.xml
  - sed -i -e 's/<policy domain="path" rights="none" pattern="@\*" \/>/<policy domain="path" rights="read|write" pattern="@*" \/>/g' $HOME/.config/ImageMagick/policy.xml
#  - sed -i -e 's/<policy domain="path" rights="none" pattern="@\*" \/>/<!-- <policy domain="path" rights="none" pattern="@*" \/> -->/g' /etc/ImageMagick/policy.xml
  - cat $HOME/.config/ImageMagick/policy.xml 
  - export MAGICK_CONFIGURE_PATH=$HOME/.config/ImageMagick/
  - identify -list policy
install:
  - python setup.py install
  - pip install -r requirements.txt
# command to run tests
script: py.test
after_script:
  - ls -lah /tmp
