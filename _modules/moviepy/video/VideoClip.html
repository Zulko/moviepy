

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>moviepy.video.VideoClip &#8212; MoviePy  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/moviepy.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/moviepy/video/VideoClip';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">
    <p>MoviePy v2.0 have introduced breaking changes,
    see <a href="https://zulko.github.io/moviepy/getting_started/updating_to_v2.html">Updating from v1.X to v2.X</a> for more info.</p>
    </div>
  </div>

  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo_small.jpeg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../_static/logo_small.jpeg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../getting_started/index.html">
                        Getting started with MoviePy
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../user_guide/index.html">
                        The MoviePy User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../reference/index.html">
                        Api Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../developer_guide/index.html">
                        The MoviePy Developers Guide
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Zulko/moviepy/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../getting_started/index.html">
                        Getting started with MoviePy
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../user_guide/index.html">
                        The MoviePy User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../reference/index.html">
                        Api Reference
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../developer_guide/index.html">
                        The MoviePy Developers Guide
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Zulko/moviepy/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">moviepy.video.VideoClip</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for moviepy.video.VideoClip</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Implements VideoClip (base class for video clips) and its main subclasses:</span>

<span class="sd">- Animated clips:     VideoFileClip, ImageSequenceClip, BitmapClip</span>
<span class="sd">- Static image clips: ImageClip, ColorClip, TextClip,</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">_copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Real</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">proglog</span>
<span class="kn">from</span> <span class="nn">imageio.v2</span> <span class="kn">import</span> <span class="n">imread</span> <span class="k">as</span> <span class="n">imread_v2</span>
<span class="kn">from</span> <span class="nn">imageio.v3</span> <span class="kn">import</span> <span class="n">imwrite</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageFont</span>

<span class="kn">from</span> <span class="nn">moviepy.video.io.ffplay_previewer</span> <span class="kn">import</span> <span class="n">ffplay_preview_video</span>


<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">moviepy.Effect</span> <span class="kn">import</span> <span class="n">Effect</span>

<span class="kn">from</span> <span class="nn">moviepy.Clip</span> <span class="kn">import</span> <span class="n">Clip</span>
<span class="kn">from</span> <span class="nn">moviepy.decorators</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">add_mask_if_none</span><span class="p">,</span>
    <span class="n">apply_to_mask</span><span class="p">,</span>
    <span class="n">convert_masks_to_RGB</span><span class="p">,</span>
    <span class="n">convert_parameter_to_seconds</span><span class="p">,</span>
    <span class="n">convert_path_to_string</span><span class="p">,</span>
    <span class="n">outplace</span><span class="p">,</span>
    <span class="n">requires_duration</span><span class="p">,</span>
    <span class="n">requires_fps</span><span class="p">,</span>
    <span class="n">use_clip_fps_by_default</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">moviepy.tools</span> <span class="kn">import</span> <span class="n">extensions_dict</span><span class="p">,</span> <span class="n">find_extension</span>
<span class="kn">from</span> <span class="nn">moviepy.video.fx.Crop</span> <span class="kn">import</span> <span class="n">Crop</span>
<span class="kn">from</span> <span class="nn">moviepy.video.fx.Resize</span> <span class="kn">import</span> <span class="n">Resize</span>
<span class="kn">from</span> <span class="nn">moviepy.video.fx.Rotate</span> <span class="kn">import</span> <span class="n">Rotate</span>
<span class="kn">from</span> <span class="nn">moviepy.video.io.ffmpeg_writer</span> <span class="kn">import</span> <span class="n">ffmpeg_write_video</span>
<span class="kn">from</span> <span class="nn">moviepy.video.io.gif_writers</span> <span class="kn">import</span> <span class="n">write_gif_with_imageio</span>
<span class="kn">from</span> <span class="nn">moviepy.video.tools.drawing</span> <span class="kn">import</span> <span class="n">blit</span>


<div class="viewcode-block" id="VideoClip"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip">[docs]</a><span class="k">class</span> <span class="nc">VideoClip</span><span class="p">(</span><span class="n">Clip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for video clips.</span>

<span class="sd">    See ``VideoFileClip``, ``ImageClip`` etc. for more user-friendly classes.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    is_mask</span>
<span class="sd">      `True` if the clip is going to be used as a mask.</span>

<span class="sd">    duration</span>
<span class="sd">      Duration of the clip in seconds. If None we got a clip of infinite</span>
<span class="sd">      duration</span>

<span class="sd">    has_constant_size</span>
<span class="sd">      Define if clip size is constant or if it may vary with time. Default</span>
<span class="sd">      to True</span>



<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    size</span>
<span class="sd">      The size of the clip, (width,height), in pixels.</span>

<span class="sd">    w, h</span>
<span class="sd">      The width and height of the clip, in pixels.</span>

<span class="sd">    is_mask</span>
<span class="sd">      Boolean set to `True` if the clip is a mask.</span>

<span class="sd">    frame_function</span>
<span class="sd">      A function ``t-&gt; frame at time t`` where ``frame`` is a</span>
<span class="sd">      w*h*3 RGB array.</span>

<span class="sd">    mask (default None)</span>
<span class="sd">      VideoClip mask attached to this clip. If mask is ``None``,</span>
<span class="sd">                The video clip is fully opaque.</span>

<span class="sd">    audio (default None)</span>
<span class="sd">      An AudioClip instance containing the audio of the video clip.</span>

<span class="sd">    pos</span>
<span class="sd">      A function ``t-&gt;(x,y)`` where ``x,y`` is the position</span>
<span class="sd">      of the clip when it is composed with other clips.</span>
<span class="sd">      See ``VideoClip.set_pos`` for more details</span>

<span class="sd">    relative_pos</span>
<span class="sd">      See variable ``pos``.</span>

<span class="sd">    layer</span>
<span class="sd">      Indicates which clip is rendered on top when two clips overlap in</span>
<span class="sd">      a CompositeVideoClip. The highest number is rendered on top.</span>
<span class="sd">      Default is 0.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">frame_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">has_constant_size</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative_pos</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">frame_function</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_function</span> <span class="o">=</span> <span class="n">frame_function</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_mask</span> <span class="o">=</span> <span class="n">is_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_constant_size</span> <span class="o">=</span> <span class="n">has_constant_size</span>
        <span class="k">if</span> <span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">duration</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">w</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the width of the video.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the height of the video.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">aspect_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the aspect ratio of the video.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@requires_duration</span>
    <span class="nd">@requires_fps</span>
    <span class="k">def</span> <span class="nf">n_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the number of frames of the video.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mixed copy of the clip.</span>

<span class="sd">        Returns a shallow copy of the clip whose mask and audio will</span>
<span class="sd">        be shallow copies of the clip&#39;s mask and audio if they exist.</span>

<span class="sd">        This method is intensively used to produce new clips every time</span>
<span class="sd">        there is an outplace transformation of the clip (clip.resize,</span>
<span class="sd">        clip.subclipped, etc.)</span>

<span class="sd">        Acts like a deepcopy except for the fact that readers and other</span>
<span class="sd">        possible unpickleables objects are not copied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">new_clip</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;audio&quot;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">new_clip</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_clip</span>

    <span class="n">copy</span> <span class="o">=</span> <span class="n">__copy__</span>

    <span class="c1"># ===============================================================</span>
    <span class="c1"># EXPORT OPERATIONS</span>

<div class="viewcode-block" id="VideoClip.save_frame"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.save_frame">[docs]</a>    <span class="nd">@convert_parameter_to_seconds</span><span class="p">([</span><span class="s2">&quot;t&quot;</span><span class="p">])</span>
    <span class="nd">@convert_masks_to_RGB</span>
    <span class="k">def</span> <span class="nf">save_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">with_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save a clip&#39;s frame to an image file.</span>

<span class="sd">        Saves the frame of clip corresponding to time ``t`` in ``filename``.</span>
<span class="sd">        ``t`` can be expressed in seconds (15.35), in (min, sec),</span>
<span class="sd">        in (hour, min, sec), or as a string: &#39;01:03:05.35&#39;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filename : str</span>
<span class="sd">          Name of the file in which the frame will be stored.</span>

<span class="sd">        t : float or tuple or str, optional</span>
<span class="sd">          Moment of the frame to be saved. As default, the first frame will be</span>
<span class="sd">          saved.</span>

<span class="sd">        with_mask : bool, optional</span>
<span class="sd">          If is ``True`` the mask is saved in the alpha layer of the picture</span>
<span class="sd">          (only works with PNGs).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_mask</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">im</span><span class="p">,</span> <span class="n">mask</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>

        <span class="n">imwrite</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span></div>

<div class="viewcode-block" id="VideoClip.write_videofile"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.write_videofile">[docs]</a>    <span class="nd">@requires_duration</span>
    <span class="nd">@use_clip_fps_by_default</span>
    <span class="nd">@convert_masks_to_RGB</span>
    <span class="nd">@convert_path_to_string</span><span class="p">([</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;temp_audiofile&quot;</span><span class="p">,</span> <span class="s2">&quot;temp_audiofile_path&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">write_videofile</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">fps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">codec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">bitrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">audio</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">audio_fps</span><span class="o">=</span><span class="mi">44100</span><span class="p">,</span>
        <span class="n">preset</span><span class="o">=</span><span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="n">audio_nbytes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">audio_codec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">audio_bitrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">audio_bufsize</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="n">temp_audiofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">temp_audiofile_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">remove_temp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">write_logfile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">threads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ffmpeg_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
        <span class="n">pixel_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the clip to a videofile.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filename</span>
<span class="sd">          Name of the video file to write in, as a string or a path-like object.</span>
<span class="sd">          The extension must correspond to the &quot;codec&quot; used (see below),</span>
<span class="sd">          or simply be &#39;.avi&#39; (which will work with any codec).</span>

<span class="sd">        fps</span>
<span class="sd">          Number of frames per second in the resulting video file. If None is</span>
<span class="sd">          provided, and the clip has an fps attribute, this fps will be used.</span>

<span class="sd">        codec</span>
<span class="sd">          Codec to use for image encoding. Can be any codec supported</span>
<span class="sd">          by ffmpeg. If the filename is has extension &#39;.mp4&#39;, &#39;.ogv&#39;, &#39;.webm&#39;,</span>
<span class="sd">          the codec will be set accordingly, but you can still set it if you</span>
<span class="sd">          don&#39;t like the default. For other extensions, the output filename</span>
<span class="sd">          must be set accordingly.</span>

<span class="sd">          Some examples of codecs are:</span>

<span class="sd">          - ``&#39;libx264&#39;`` (default codec for file extension ``.mp4``)</span>
<span class="sd">            makes well-compressed videos (quality tunable using &#39;bitrate&#39;).</span>
<span class="sd">          - ``&#39;mpeg4&#39;`` (other codec for extension ``.mp4``) can be an alternative</span>
<span class="sd">            to ``&#39;libx264&#39;``, and produces higher quality videos by default.</span>
<span class="sd">          - ``&#39;rawvideo&#39;`` (use file extension ``.avi``) will produce</span>
<span class="sd">            a video of perfect quality, of possibly very huge size.</span>
<span class="sd">          - ``png`` (use file extension ``.avi``) will produce a video</span>
<span class="sd">            of perfect quality, of smaller size than with ``rawvideo``.</span>
<span class="sd">          - ``&#39;libvorbis&#39;`` (use file extension ``.ogv``) is a nice video</span>
<span class="sd">            format, which is completely free/ open source. However not</span>
<span class="sd">            everyone has the codecs installed by default on their machine.</span>
<span class="sd">          - ``&#39;libvpx&#39;`` (use file extension ``.webm``) is tiny a video</span>
<span class="sd">            format well indicated for web videos (with HTML5). Open source.</span>

<span class="sd">        audio</span>
<span class="sd">          Either ``True``, ``False``, or a file name.</span>
<span class="sd">          If ``True`` and the clip has an audio clip attached, this</span>
<span class="sd">          audio clip will be incorporated as a soundtrack in the movie.</span>
<span class="sd">          If ``audio`` is the name of an audio file, this audio file</span>
<span class="sd">          will be incorporated as a soundtrack in the movie.</span>

<span class="sd">        audio_fps</span>
<span class="sd">          frame rate to use when generating the sound.</span>

<span class="sd">        temp_audiofile</span>
<span class="sd">          the name of the temporary audiofile, as a string or path-like object,</span>
<span class="sd">          to be created and then used to write the complete video, if any.</span>

<span class="sd">        temp_audiofile_path</span>
<span class="sd">          the location that the temporary audiofile is placed, as a</span>
<span class="sd">          string or path-like object. Defaults to the current working directory.</span>

<span class="sd">        audio_codec</span>
<span class="sd">          Which audio codec should be used. Examples are &#39;libmp3lame&#39;</span>
<span class="sd">          for &#39;.mp3&#39;, &#39;libvorbis&#39; for &#39;ogg&#39;, &#39;libfdk_aac&#39;:&#39;m4a&#39;,</span>
<span class="sd">          &#39;pcm_s16le&#39; for 16-bit wav and &#39;pcm_s32le&#39; for 32-bit wav.</span>
<span class="sd">          Default is &#39;libmp3lame&#39;, unless the video extension is &#39;ogv&#39;</span>
<span class="sd">          or &#39;webm&#39;, at which case the default is &#39;libvorbis&#39;.</span>

<span class="sd">        audio_bitrate</span>
<span class="sd">          Audio bitrate, given as a string like &#39;50k&#39;, &#39;500k&#39;, &#39;3000k&#39;.</span>
<span class="sd">          Will determine the size/quality of audio in the output file.</span>
<span class="sd">          Note that it mainly an indicative goal, the bitrate won&#39;t</span>
<span class="sd">          necessarily be the this in the final file.</span>

<span class="sd">        preset</span>
<span class="sd">          Sets the time that FFMPEG will spend optimizing the compression.</span>
<span class="sd">          Choices are: ultrafast, superfast, veryfast, faster, fast, medium,</span>
<span class="sd">          slow, slower, veryslow, placebo. Note that this does not impact</span>
<span class="sd">          the quality of the video, only the size of the video file. So</span>
<span class="sd">          choose ultrafast when you are in a hurry and file size does not</span>
<span class="sd">          matter.</span>

<span class="sd">        threads</span>
<span class="sd">          Number of threads to use for ffmpeg. Can speed up the writing of</span>
<span class="sd">          the video on multicore computers.</span>

<span class="sd">        ffmpeg_params</span>
<span class="sd">          Any additional ffmpeg parameters you would like to pass, as a list</span>
<span class="sd">          of terms, like [&#39;-option1&#39;, &#39;value1&#39;, &#39;-option2&#39;, &#39;value2&#39;].</span>

<span class="sd">        write_logfile</span>
<span class="sd">          If true, will write log files for the audio and the video.</span>
<span class="sd">          These will be files ending with &#39;.log&#39; with the name of the</span>
<span class="sd">          output file in them.</span>

<span class="sd">        logger</span>
<span class="sd">          Either ``&quot;bar&quot;`` for progress bar or ``None`` or any Proglog logger.</span>

<span class="sd">        pixel_format</span>
<span class="sd">          Pixel format for the output video file.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            from moviepy import VideoFileClip</span>
<span class="sd">            clip = VideoFileClip(&quot;myvideo.mp4&quot;).subclipped(100,120)</span>
<span class="sd">            clip.write_videofile(&quot;my_new_video.mp4&quot;)</span>
<span class="sd">            clip.close()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">proglog</span><span class="o">.</span><span class="n">default_bar_logger</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">codec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">codec</span> <span class="o">=</span> <span class="n">extensions_dict</span><span class="p">[</span><span class="n">ext</span><span class="p">][</span><span class="s2">&quot;codec&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;MoviePy couldn&#39;t find the codec associated &quot;</span>
                    <span class="s2">&quot;with the filename. Provide the &#39;codec&#39; &quot;</span>
                    <span class="s2">&quot;parameter in write_videofile.&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">audio_codec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ogv&quot;</span><span class="p">,</span> <span class="s2">&quot;webm&quot;</span><span class="p">]:</span>
                <span class="n">audio_codec</span> <span class="o">=</span> <span class="s2">&quot;libvorbis&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">audio_codec</span> <span class="o">=</span> <span class="s2">&quot;libmp3lame&quot;</span>
        <span class="k">elif</span> <span class="n">audio_codec</span> <span class="o">==</span> <span class="s2">&quot;raw16&quot;</span><span class="p">:</span>
            <span class="n">audio_codec</span> <span class="o">=</span> <span class="s2">&quot;pcm_s16le&quot;</span>
        <span class="k">elif</span> <span class="n">audio_codec</span> <span class="o">==</span> <span class="s2">&quot;raw32&quot;</span><span class="p">:</span>
            <span class="n">audio_codec</span> <span class="o">=</span> <span class="s2">&quot;pcm_s32le&quot;</span>

        <span class="n">audiofile</span> <span class="o">=</span> <span class="n">audio</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">audio</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">make_audio</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">audiofile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">audio</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">make_audio</span> <span class="ow">and</span> <span class="n">temp_audiofile</span><span class="p">:</span>
            <span class="c1"># The audio will be the clip&#39;s audio</span>
            <span class="n">audiofile</span> <span class="o">=</span> <span class="n">temp_audiofile</span>
        <span class="k">elif</span> <span class="n">make_audio</span><span class="p">:</span>
            <span class="n">audio_ext</span> <span class="o">=</span> <span class="n">find_extension</span><span class="p">(</span><span class="n">audio_codec</span><span class="p">)</span>
            <span class="n">audiofile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">temp_audiofile_path</span><span class="p">,</span>
                <span class="n">name</span> <span class="o">+</span> <span class="n">Clip</span><span class="o">.</span><span class="n">_TEMP_FILES_PREFIX</span> <span class="o">+</span> <span class="s2">&quot;wvf_snd.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">audio_ext</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># enough cpu for multiprocessing ? USELESS RIGHT NOW, WILL COME AGAIN</span>
        <span class="c1"># enough_cpu = (multiprocessing.cpu_count() &gt; 1)</span>
        <span class="n">logger</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;MoviePy - Building video </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">make_audio</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">write_audiofile</span><span class="p">(</span>
                <span class="n">audiofile</span><span class="p">,</span>
                <span class="n">audio_fps</span><span class="p">,</span>
                <span class="n">audio_nbytes</span><span class="p">,</span>
                <span class="n">audio_bufsize</span><span class="p">,</span>
                <span class="n">audio_codec</span><span class="p">,</span>
                <span class="n">bitrate</span><span class="o">=</span><span class="n">audio_bitrate</span><span class="p">,</span>
                <span class="n">write_logfile</span><span class="o">=</span><span class="n">write_logfile</span><span class="p">,</span>
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">ffmpeg_write_video</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">fps</span><span class="p">,</span>
            <span class="n">codec</span><span class="p">,</span>
            <span class="n">bitrate</span><span class="o">=</span><span class="n">bitrate</span><span class="p">,</span>
            <span class="n">preset</span><span class="o">=</span><span class="n">preset</span><span class="p">,</span>
            <span class="n">write_logfile</span><span class="o">=</span><span class="n">write_logfile</span><span class="p">,</span>
            <span class="n">audiofile</span><span class="o">=</span><span class="n">audiofile</span><span class="p">,</span>
            <span class="n">threads</span><span class="o">=</span><span class="n">threads</span><span class="p">,</span>
            <span class="n">ffmpeg_params</span><span class="o">=</span><span class="n">ffmpeg_params</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
            <span class="n">pixel_format</span><span class="o">=</span><span class="n">pixel_format</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">remove_temp</span> <span class="ow">and</span> <span class="n">make_audio</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">audiofile</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">audiofile</span><span class="p">)</span>
        <span class="n">logger</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s2">&quot;MoviePy - video ready </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="VideoClip.write_images_sequence"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.write_images_sequence">[docs]</a>    <span class="nd">@requires_duration</span>
    <span class="nd">@use_clip_fps_by_default</span>
    <span class="nd">@convert_masks_to_RGB</span>
    <span class="k">def</span> <span class="nf">write_images_sequence</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name_format</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Writes the videoclip to a sequence of image files.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        name_format</span>
<span class="sd">          A filename specifying the numerotation format and extension</span>
<span class="sd">          of the pictures. For instance &quot;frame%03d.png&quot; for filenames</span>
<span class="sd">          indexed with 3 digits and PNG format. Also possible:</span>
<span class="sd">          &quot;some_folder/frame%04d.jpeg&quot;, etc.</span>

<span class="sd">        fps</span>
<span class="sd">          Number of frames per second to consider when writing the</span>
<span class="sd">          clip. If not specified, the clip&#39;s ``fps`` attribute will</span>
<span class="sd">          be used if it has one.</span>

<span class="sd">        with_mask</span>
<span class="sd">          will save the clip&#39;s mask (if any) as an alpha canal (PNGs only).</span>

<span class="sd">        logger</span>
<span class="sd">          Either ``&quot;bar&quot;`` for progress bar or ``None`` or any Proglog logger.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        names_list</span>
<span class="sd">          A list of all the files generated.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The resulting image sequence can be read using e.g. the class</span>
<span class="sd">        ``ImageSequenceClip``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">proglog</span><span class="o">.</span><span class="n">default_bar_logger</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
        <span class="c1"># Fails on GitHub macos CI</span>
        <span class="c1"># logger(message=&quot;MoviePy - Writing frames %s.&quot; % name_format)</span>

        <span class="n">timings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">fps</span><span class="p">)</span>

        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">iter_bar</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">timings</span><span class="p">))):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name_format</span> <span class="o">%</span> <span class="n">i</span>
            <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_frame</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">with_mask</span><span class="o">=</span><span class="n">with_mask</span><span class="p">)</span>
        <span class="c1"># logger(message=&quot;MoviePy - Done writing frames %s.&quot; % name_format)</span>

        <span class="k">return</span> <span class="n">filenames</span></div>

<div class="viewcode-block" id="VideoClip.write_gif"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.write_gif">[docs]</a>    <span class="nd">@requires_duration</span>
    <span class="nd">@convert_masks_to_RGB</span>
    <span class="nd">@convert_path_to_string</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">write_gif</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">fps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the VideoClip to a GIF file.</span>

<span class="sd">        Converts a VideoClip into an animated GIF using imageio</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filename</span>
<span class="sd">          Name of the resulting gif file, as a string or a path-like object.</span>

<span class="sd">        fps</span>
<span class="sd">          Number of frames per second (see note below). If it</span>
<span class="sd">          isn&#39;t provided, then the function will look for the clip&#39;s</span>
<span class="sd">          ``fps`` attribute (VideoFileClip, for instance, have one).</span>

<span class="sd">        loop : int, optional</span>
<span class="sd">          Repeat the clip using ``loop`` iterations in the resulting GIF.</span>

<span class="sd">        progress_bar</span>
<span class="sd">          If True, displays a progress bar</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The gif will be playing the clip in real time (you can</span>
<span class="sd">        only change the frame rate). If you want the gif to be played</span>
<span class="sd">        slower than the clip you will use</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            # slow down clip 50% and make it a gif</span>
<span class="sd">            myClip.multiply_speed(0.5).to_gif(&#39;myClip.gif&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># A little sketchy at the moment, maybe move all that in write_gif,</span>
        <span class="c1">#  refactor a little... we will see.</span>

        <span class="n">write_gif_with_imageio</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">filename</span><span class="p">,</span>
            <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span>
            <span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="c1"># ===============================================================</span>
    <span class="c1"># PREVIEW OPERATIONS</span>

<div class="viewcode-block" id="VideoClip.show"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.show">[docs]</a>    <span class="nd">@convert_masks_to_RGB</span>
    <span class="nd">@convert_parameter_to_seconds</span><span class="p">([</span><span class="s2">&quot;t&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">with_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Splashes the frame of clip corresponding to time ``t``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        t : float or tuple or str, optional</span>
<span class="sd">        Time in seconds of the frame to display.</span>

<span class="sd">        with_mask : bool, optional</span>
<span class="sd">        ``False`` if the clip has a mask but you want to see the clip without</span>
<span class="sd">        the mask.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            from moviepy import *</span>

<span class="sd">            clip = VideoFileClip(&quot;media/chaplin.mp4&quot;)</span>
<span class="sd">            clip.show(t=4)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Warning : Comment to fix a bug on preview for compositevideoclip</span>
        <span class="c1"># it broke compositevideoclip and it does nothing on normal clip with alpha</span>

        <span class="c1"># if with_mask and (self.mask is not None):</span>
        <span class="c1">#   # Hate it, but cannot figure a better way with python awful circular</span>
        <span class="c1">#   # dependency</span>
        <span class="c1">#   from mpy.video.compositing.CompositeVideoClip import CompositeVideoClip</span>
        <span class="c1">#   clip = CompositeVideoClip([self.with_position((0, 0))])</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="n">clip</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">pil_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">))</span>

        <span class="n">pil_img</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="VideoClip.preview"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.preview">[docs]</a>    <span class="nd">@requires_duration</span>
    <span class="nd">@convert_masks_to_RGB</span>
    <span class="k">def</span> <span class="nf">preview</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">audio</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">audio_fps</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span> <span class="n">audio_buffersize</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">audio_nbytes</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays the clip in a window, at the given frames per second.</span>

<span class="sd">        It will avoid that the clip be played faster than normal, but it</span>
<span class="sd">        cannot avoid the clip to be played slower than normal if the computations</span>
<span class="sd">        are complex. In this case, try reducing the ``fps``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fps : int, optional</span>
<span class="sd">        Number of frames per seconds in the displayed video. Default to ``15``.</span>

<span class="sd">        audio : bool, optional</span>
<span class="sd">        ``True`` (default) if you want the clip&#39;s audio be played during</span>
<span class="sd">        the preview.</span>

<span class="sd">        audio_fps : int, optional</span>
<span class="sd">        The frames per second to use when generating the audio sound.</span>

<span class="sd">        audio_buffersize : int, optional</span>
<span class="sd">        The sized of the buffer used generating the audio sound.</span>

<span class="sd">        audio_nbytes : int, optional</span>
<span class="sd">        The number of bytes used generating the audio sound.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            from moviepy import *</span>
<span class="sd">            clip = VideoFileClip(&quot;media/chaplin.mp4&quot;)</span>
<span class="sd">            clip.preview(fps=10, audio=False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">audio</span> <span class="o">=</span> <span class="n">audio</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">audio_flag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">video_flag</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">audio</span><span class="p">:</span>
            <span class="c1"># the sound will be played in parallel. We are not</span>
            <span class="c1"># parralellizing it on different CPUs because it seems that</span>
            <span class="c1"># ffplay use several cpus.</span>

            <span class="c1"># two synchro-flags to tell whether audio and video are ready</span>
            <span class="n">video_flag</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
            <span class="n">audio_flag</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
            <span class="c1"># launch the thread</span>
            <span class="n">audiothread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">audio</span><span class="o">.</span><span class="n">audiopreview</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">audio_fps</span><span class="p">,</span>
                    <span class="n">audio_buffersize</span><span class="p">,</span>
                    <span class="n">audio_nbytes</span><span class="p">,</span>
                    <span class="n">audio_flag</span><span class="p">,</span>
                    <span class="n">video_flag</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="n">audiothread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># passthrough to ffmpeg, passing flag for ffmpeg to set</span>
        <span class="n">ffplay_preview_video</span><span class="p">(</span>
            <span class="n">clip</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span> <span class="n">audio_flag</span><span class="o">=</span><span class="n">audio_flag</span><span class="p">,</span> <span class="n">video_flag</span><span class="o">=</span><span class="n">video_flag</span>
        <span class="p">)</span></div>

    <span class="c1"># -----------------------------------------------------------------</span>
    <span class="c1"># F I L T E R I N G</span>

<div class="viewcode-block" id="VideoClip.with_effects_on_subclip"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.with_effects_on_subclip">[docs]</a>    <span class="k">def</span> <span class="nf">with_effects_on_subclip</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">effects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Effect&quot;</span><span class="p">],</span> <span class="n">start_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply a transformation to a part of the clip.</span>

<span class="sd">        Returns a new clip in which the function ``fun`` (clip-&gt;clip)</span>
<span class="sd">        has been applied to the subclip between times `start_time` and `end_time`</span>
<span class="sd">        (in seconds).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            # The scene between times t=3s and t=6s in ``clip`` will be</span>
<span class="sd">            # be played twice slower in ``new_clip``</span>
<span class="sd">            new_clip = clip.with_sub_effect(MultiplySpeed(0.5), 3, 6)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">left</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">start_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclipped</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclipped</span><span class="p">(</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">)</span><span class="o">.</span><span class="n">with_effects</span><span class="p">(</span><span class="n">effects</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">subclipped</span><span class="p">(</span><span class="n">start_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">)</span>

        <span class="n">clips</span> <span class="o">=</span> <span class="p">[</span><span class="n">clip</span> <span class="k">for</span> <span class="n">clip</span> <span class="ow">in</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">right</span><span class="p">]</span> <span class="k">if</span> <span class="n">clip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>

        <span class="c1"># beurk, have to find other solution</span>
        <span class="kn">from</span> <span class="nn">moviepy.video.compositing.CompositeVideoClip</span> <span class="kn">import</span> <span class="n">concatenate_videoclips</span>

        <span class="k">return</span> <span class="n">concatenate_videoclips</span><span class="p">(</span><span class="n">clips</span><span class="p">)</span><span class="o">.</span><span class="n">with_start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span></div>

    <span class="c1"># IMAGE FILTERS</span>

<div class="viewcode-block" id="VideoClip.image_transform"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.image_transform">[docs]</a>    <span class="k">def</span> <span class="nf">image_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_func</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Modifies the images of a clip by replacing the frame `get_frame(t)` by</span>
<span class="sd">        another frame,  `image_func(get_frame(t))`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">apply_to</span> <span class="o">=</span> <span class="n">apply_to</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">get_frame</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">image_func</span><span class="p">(</span><span class="n">get_frame</span><span class="p">(</span><span class="n">t</span><span class="p">)),</span> <span class="n">apply_to</span><span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># C O M P O S I T I N G</span>

<div class="viewcode-block" id="VideoClip.fill_array"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.fill_array">[docs]</a>    <span class="k">def</span> <span class="nf">fill_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pre_array</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fills an array to match the specified shape.</span>

<span class="sd">        If the `pre_array` is smaller than the desired shape, the missing rows</span>
<span class="sd">        or columns are added with ones to the bottom or right, respectively,</span>
<span class="sd">        until the shape matches. If the `pre_array` is larger than the desired</span>
<span class="sd">        shape, the excess rows or columns are cropped from the bottom or right,</span>
<span class="sd">        respectively, until the shape matches.</span>

<span class="sd">        The resulting array with the filled shape is returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pre_array (numpy.ndarray)</span>
<span class="sd">          The original array to be filled.</span>

<span class="sd">        shape (tuple)</span>
<span class="sd">          The desired shape of the resulting array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pre_shape</span> <span class="o">=</span> <span class="n">pre_array</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pre_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pre_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">post_array</span> <span class="o">=</span> <span class="n">pre_array</span>
        <span class="k">if</span> <span class="n">dx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">post_array</span> <span class="o">=</span> <span class="n">pre_array</span><span class="p">[:</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">dx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x_1</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">pre_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">dx</span>
            <span class="n">post_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pre_array</span><span class="p">,</span> <span class="n">x_1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">dy</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">post_array</span> <span class="o">=</span> <span class="n">post_array</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">dy</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x_1</span> <span class="o">=</span> <span class="p">[[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="n">dy</span><span class="p">]</span> <span class="o">*</span> <span class="n">post_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">post_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">post_array</span><span class="p">,</span> <span class="n">x_1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">post_array</span></div>

<div class="viewcode-block" id="VideoClip.blit_on"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.blit_on">[docs]</a>    <span class="k">def</span> <span class="nf">blit_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picture</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the result of the blit of the clip&#39;s frame at time `t`</span>
<span class="sd">        on the given `picture`, the position of the clip being given</span>
<span class="sd">        by the clip&#39;s ``pos`` attribute. Meant for compositing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wf</span><span class="p">,</span> <span class="n">hf</span> <span class="o">=</span> <span class="n">picture</span><span class="o">.</span><span class="n">size</span>

        <span class="n">ct</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>  <span class="c1"># clip time</span>

        <span class="c1"># GET IMAGE AND MASK IF ANY</span>
        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
        <span class="n">im_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
            <span class="n">im_mask</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">im_img</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">im_mask</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">bg_size</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">im_img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">im_mask</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">im_img</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">im_mask</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="p">)</span>

                <span class="n">im_img_bg</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="n">bg_size</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
                <span class="n">im_img_bg</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_img</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

                <span class="n">im_mask_bg</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="n">bg_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">im_mask_bg</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_mask</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

                <span class="n">im_img</span><span class="p">,</span> <span class="n">im_mask</span> <span class="o">=</span> <span class="n">im_img_bg</span><span class="p">,</span> <span class="n">im_mask_bg</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">im_mask</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">wi</span><span class="p">,</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">im_img</span><span class="o">.</span><span class="n">size</span>
        <span class="c1"># SET POSITION</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>

        <span class="c1"># preprocess short writings of the position</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">],</span>
                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">],</span>
                <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">],</span>
                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">],</span>
                <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">],</span>
            <span class="p">}[</span><span class="n">pos</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="c1"># is the position relative (given in % of the clip&#39;s size) ?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_pos</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">wf</span><span class="p">,</span> <span class="n">hf</span><span class="p">]):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dim</span> <span class="o">*</span> <span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">D</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">wf</span> <span class="o">-</span> <span class="n">wi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="n">wf</span> <span class="o">-</span> <span class="n">wi</span><span class="p">}</span>
            <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">D</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">hf</span> <span class="o">-</span> <span class="n">hi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="n">hf</span> <span class="o">-</span> <span class="n">hi</span><span class="p">}</span>
            <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">blit</span><span class="p">(</span><span class="n">im_img</span><span class="p">,</span> <span class="n">picture</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">im_mask</span><span class="p">)</span></div>

<div class="viewcode-block" id="VideoClip.with_background_color"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.with_background_color">[docs]</a>    <span class="k">def</span> <span class="nf">with_background_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">pos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Place the clip on a colored background.</span>

<span class="sd">        Returns a clip made of the current clip overlaid on a color</span>
<span class="sd">        clip of a possibly bigger size. Can serve to flatten transparent</span>
<span class="sd">        clips.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        size</span>
<span class="sd">          Size (width, height) in pixels of the final clip.</span>
<span class="sd">          By default it will be the size of the current clip.</span>

<span class="sd">        color</span>
<span class="sd">          Background color of the final clip ([R,G,B]).</span>

<span class="sd">        pos</span>
<span class="sd">          Position of the clip in the final clip. &#39;center&#39; is the default</span>

<span class="sd">        opacity</span>
<span class="sd">          Parameter in 0..1 indicating the opacity of the colored</span>
<span class="sd">          background.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">moviepy.video.compositing.CompositeVideoClip</span> <span class="kn">import</span> <span class="n">CompositeVideoClip</span>

        <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span>

        <span class="k">if</span> <span class="n">opacity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorclip</span> <span class="o">=</span> <span class="n">ColorClip</span><span class="p">(</span>
                <span class="n">size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span>
            <span class="p">)</span><span class="o">.</span><span class="n">with_opacity</span><span class="p">(</span><span class="n">opacity</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">CompositeVideoClip</span><span class="p">([</span><span class="n">colorclip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_position</span><span class="p">(</span><span class="n">pos</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">CompositeVideoClip</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">with_position</span><span class="p">(</span><span class="n">pos</span><span class="p">)],</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">bg_color</span><span class="o">=</span><span class="n">color</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ImageClip</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;__call__&quot;</span><span class="p">))</span>
            <span class="ow">and</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">ImageClip</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="n">new_result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_ImageClip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_result</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">to_ImageClip</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">new_result</span><span class="o">.</span><span class="n">with_duration</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="VideoClip.with_updated_frame_function"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.with_updated_frame_function">[docs]</a>    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">with_updated_frame_function</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">frame_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the clip&#39;s ``get_frame``.</span>

<span class="sd">        Returns a copy of the VideoClip instance, with the frame_function</span>
<span class="sd">        attribute set to `mf`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_function</span> <span class="o">=</span> <span class="n">frame_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="VideoClip.with_audio"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.with_audio">[docs]</a>    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">with_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">audioclip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attach an AudioClip to the VideoClip.</span>

<span class="sd">        Returns a copy of the VideoClip instance, with the `audio`</span>
<span class="sd">        attribute set to ``audio``, which must be an AudioClip instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="o">=</span> <span class="n">audioclip</span></div>

<div class="viewcode-block" id="VideoClip.with_mask"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.with_mask">[docs]</a>    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">with_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;VideoClip&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the clip&#39;s mask.</span>

<span class="sd">        Returns a copy of the VideoClip with the mask attribute set to</span>
<span class="sd">        ``mask``, which must be a greyscale (values in 0-1) VideoClip.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_constant_size</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">ColorClip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="k">def</span> <span class="nf">frame_function</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

                <span class="n">mask</span> <span class="o">=</span> <span class="n">VideoClip</span><span class="p">(</span><span class="n">is_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">frame_function</span><span class="o">=</span><span class="n">frame_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span></div>

<div class="viewcode-block" id="VideoClip.without_mask"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.without_mask">[docs]</a>    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">without_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the clip&#39;s mask.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="VideoClip.with_opacity"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.with_opacity">[docs]</a>    <span class="nd">@add_mask_if_none</span>
    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">with_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opacity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the opacity/transparency level of the clip.</span>

<span class="sd">        Returns a semi-transparent copy of the clip where the mask is</span>
<span class="sd">        multiplied by ``op`` (any float, normally between 0 and 1).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">image_transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pic</span><span class="p">:</span> <span class="n">opacity</span> <span class="o">*</span> <span class="n">pic</span><span class="p">)</span></div>

<div class="viewcode-block" id="VideoClip.with_position"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.with_position">[docs]</a>    <span class="nd">@apply_to_mask</span>
    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">with_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the clip&#39;s position in compositions.</span>

<span class="sd">        Sets the position that the clip will have when included</span>
<span class="sd">        in compositions. The argument ``pos`` can be either a couple</span>
<span class="sd">        ``(x,y)`` or a function ``t-&gt; (x,y)``. `x` and `y` mark the</span>
<span class="sd">        location of the top left corner of the clip, and can be</span>
<span class="sd">        of several types.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code:: python</span>

<span class="sd">            clip.with_position((45,150)) # x=45, y=150</span>

<span class="sd">            # clip horizontally centered, at the top of the picture</span>
<span class="sd">            clip.with_position((&quot;center&quot;,&quot;top&quot;))</span>

<span class="sd">            # clip is at 40% of the width, 70% of the height:</span>
<span class="sd">            clip.with_position((0.4,0.7), relative=True)</span>

<span class="sd">            # clip&#39;s position is horizontally centered, and moving up !</span>
<span class="sd">            clip.with_position(lambda t: (&#39;center&#39;, 50+t))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative_pos</span> <span class="o">=</span> <span class="n">relative</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="s2">&quot;__call__&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">pos</span></div>

<div class="viewcode-block" id="VideoClip.with_layer_index"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.with_layer_index">[docs]</a>    <span class="nd">@apply_to_mask</span>
    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">with_layer_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the clip&#39;s layer in compositions. Clips with a greater ``layer``</span>
<span class="sd">        attribute will be displayed on top of others.</span>

<span class="sd">        Note: Only has effect when the clip is used in a CompositeVideoClip.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_index</span> <span class="o">=</span> <span class="n">index</span></div>

<div class="viewcode-block" id="VideoClip.resized"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.resized">[docs]</a>    <span class="k">def</span> <span class="nf">resized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apply_to_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a video clip that is a resized version of the clip.</span>
<span class="sd">        For info on the parameters, please see ``vfx.Resize``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_effects</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">Resize</span><span class="p">(</span>
                    <span class="n">new_size</span><span class="o">=</span><span class="n">new_size</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                    <span class="n">apply_to_mask</span><span class="o">=</span><span class="n">apply_to_mask</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VideoClip.rotated"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.rotated">[docs]</a>    <span class="k">def</span> <span class="nf">rotated</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;deg&quot;</span><span class="p">,</span>
        <span class="n">resample</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bicubic&quot;</span><span class="p">,</span>
        <span class="n">expand</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">center</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">translate</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">bg_color</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rotates the specified clip by ``angle`` degrees (or radians) anticlockwise</span>
<span class="sd">        If the angle is not a multiple of 90 (degrees) or ``center``, ``translate``,</span>
<span class="sd">        and ``bg_color`` are not ``None``.</span>
<span class="sd">        For info on the parameters, please see ``vfx.Rotate``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_effects</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">Rotate</span><span class="p">(</span>
                    <span class="n">angle</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span>
                    <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span>
                    <span class="n">resample</span><span class="o">=</span><span class="n">resample</span><span class="p">,</span>
                    <span class="n">expand</span><span class="o">=</span><span class="n">expand</span><span class="p">,</span>
                    <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span>
                    <span class="n">translate</span><span class="o">=</span><span class="n">translate</span><span class="p">,</span>
                    <span class="n">bg_color</span><span class="o">=</span><span class="n">bg_color</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VideoClip.cropped"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.cropped">[docs]</a>    <span class="k">def</span> <span class="nf">cropped</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">x2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">x_center</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y_center</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a new clip in which just a rectangular subregion of the</span>
<span class="sd">        original clip is conserved. x1,y1 indicates the top left corner and</span>
<span class="sd">        x2,y2 is the lower right corner of the cropped region.</span>
<span class="sd">        All coordinates are in pixels. Float numbers are accepted.</span>
<span class="sd">        For info on the parameters, please see ``vfx.Crop``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_effects</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">Crop</span><span class="p">(</span>
                    <span class="n">x1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span>
                    <span class="n">y1</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span>
                    <span class="n">x2</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span>
                    <span class="n">y2</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                    <span class="n">x_center</span><span class="o">=</span><span class="n">x_center</span><span class="p">,</span>
                    <span class="n">y_center</span><span class="o">=</span><span class="n">y_center</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="p">)</span></div>

    <span class="c1"># --------------------------------------------------------------</span>
    <span class="c1"># CONVERSIONS TO OTHER TYPES</span>

<div class="viewcode-block" id="VideoClip.to_ImageClip"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.to_ImageClip">[docs]</a>    <span class="nd">@convert_parameter_to_seconds</span><span class="p">([</span><span class="s2">&quot;t&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">to_ImageClip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">with_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an ImageClip made out of the clip&#39;s frame at time ``t``,</span>
<span class="sd">        which can be expressed in seconds (15.35), in (min, sec),</span>
<span class="sd">        in (hour, min, sec), or as a string: &#39;01:03:05.35&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_clip</span> <span class="o">=</span> <span class="n">ImageClip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">is_mask</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_mask</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">with_mask</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_clip</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">to_ImageClip</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_clip</span></div>

<div class="viewcode-block" id="VideoClip.to_mask"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.to_mask">[docs]</a>    <span class="k">def</span> <span class="nf">to_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canal</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a mask a video clip made from the clip.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mask</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_clip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pic</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">pic</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">canal</span><span class="p">]</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
            <span class="n">new_clip</span><span class="o">.</span><span class="n">is_mask</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">new_clip</span></div>

<div class="viewcode-block" id="VideoClip.to_RGB"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.to_RGB">[docs]</a>    <span class="k">def</span> <span class="nf">to_RGB</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a non-mask video clip made from the mask video clip.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mask</span><span class="p">:</span>
            <span class="n">new_clip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_transform</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">pic</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">[</span><span class="mi">255</span> <span class="o">*</span> <span class="n">pic</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">new_clip</span><span class="o">.</span><span class="n">is_mask</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">new_clip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span></div>

    <span class="c1"># ----------------------------------------------------------------</span>
    <span class="c1"># Audio</span>

<div class="viewcode-block" id="VideoClip.without_audio"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.VideoClip.html#moviepy.video.VideoClip.VideoClip.without_audio">[docs]</a>    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">without_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the clip&#39;s audio.</span>

<span class="sd">        Return a copy of the clip with audio set to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audio</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VideoClip</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">moviepy.video.compositing.CompositeVideoClip</span> <span class="kn">import</span> <span class="p">(</span>
                <span class="n">concatenate_videoclips</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;chain&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">size</span> <span class="k">else</span> <span class="s2">&quot;compose&quot;</span>
            <span class="k">return</span> <span class="n">concatenate_videoclips</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">VideoClip</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the or (self | other) to produce a video with self and other</span>
<span class="sd">        placed side by side horizontally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VideoClip</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">moviepy.video.compositing.CompositeVideoClip</span> <span class="kn">import</span> <span class="n">clips_array</span>

            <span class="k">return</span> <span class="n">clips_array</span><span class="p">([[</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">]])</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">VideoClip</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__or__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement division (self / other) to produce a video with self</span>
<span class="sd">        placed on top of other.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VideoClip</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">moviepy.video.compositing.CompositeVideoClip</span> <span class="kn">import</span> <span class="n">clips_array</span>

            <span class="k">return</span> <span class="n">clips_array</span><span class="p">([[</span><span class="bp">self</span><span class="p">],</span> <span class="p">[</span><span class="n">other</span><span class="p">]])</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">VideoClip</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__or__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement matrice multiplication (self @ other) to rotate a video</span>
<span class="sd">        by other degrees</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Real</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

        <span class="kn">from</span> <span class="nn">moviepy.video.fx.Rotate</span> <span class="kn">import</span> <span class="n">Rotate</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_effects</span><span class="p">([</span><span class="n">Rotate</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>

    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the and (self &amp; other) to produce a video with other</span>
<span class="sd">        used as a mask for self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span></div>


<div class="viewcode-block" id="DataVideoClip"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.DataVideoClip.html#moviepy.video.VideoClip.DataVideoClip">[docs]</a><span class="k">class</span> <span class="nc">DataVideoClip</span><span class="p">(</span><span class="n">VideoClip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class of video clips whose successive frames are functions</span>
<span class="sd">    of successive datasets</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data</span>
<span class="sd">      A list of datasets, each dataset being used for one frame of the clip</span>

<span class="sd">    data_to_frame</span>
<span class="sd">      A function d -&gt; video frame, where d is one element of the list `data`</span>

<span class="sd">    fps</span>
<span class="sd">      Number of frames per second in the animation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_to_frame</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">has_constant_size</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_to_frame</span> <span class="o">=</span> <span class="n">data_to_frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span>

        <span class="k">def</span> <span class="nf">frame_function</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_to_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">*</span> <span class="n">t</span><span class="p">)])</span>

        <span class="n">VideoClip</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frame_function</span><span class="p">,</span>
            <span class="n">is_mask</span><span class="o">=</span><span class="n">is_mask</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="mf">1.0</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">fps</span><span class="p">,</span>
            <span class="n">has_constant_size</span><span class="o">=</span><span class="n">has_constant_size</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="UpdatedVideoClip"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.UpdatedVideoClip.html#moviepy.video.VideoClip.UpdatedVideoClip">[docs]</a><span class="k">class</span> <span class="nc">UpdatedVideoClip</span><span class="p">(</span><span class="n">VideoClip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class of clips whose frame_function requires some objects to</span>
<span class="sd">    be updated. Particularly practical in science where some</span>
<span class="sd">    algorithm needs to make some steps before a new frame can</span>
<span class="sd">    be generated.</span>

<span class="sd">    UpdatedVideoClips have the following frame_function:</span>

<span class="sd">    .. code:: python</span>

<span class="sd">        def frame_function(t):</span>
<span class="sd">            while self.world.clip_t &lt; t:</span>
<span class="sd">                world.update() # updates, and increases world.clip_t</span>
<span class="sd">            return world.to_frame()</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    world</span>
<span class="sd">      An object with the following attributes:</span>
<span class="sd">      - world.clip_t: the clip&#39;s time corresponding to the world&#39;s state.</span>
<span class="sd">      - world.update() : update the world&#39;s state, (including increasing</span>
<span class="sd">      world.clip_t of one time step).</span>
<span class="sd">      - world.to_frame() : renders a frame depending on the world&#39;s state.</span>

<span class="sd">    is_mask</span>
<span class="sd">      True if the clip is a WxH mask with values in 0-1</span>

<span class="sd">    duration</span>
<span class="sd">      Duration of the clip, in seconds</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">world</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">world</span>

        <span class="k">def</span> <span class="nf">frame_function</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">clip_t</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">world</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">world</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>

        <span class="n">VideoClip</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">frame_function</span><span class="o">=</span><span class="n">frame_function</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="n">is_mask</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span>
        <span class="p">)</span></div>


<span class="sd">&quot;&quot;&quot;---------------------------------------------------------------------</span>

<span class="sd">    ImageClip (base class for all &#39;static clips&#39;) and its subclasses</span>
<span class="sd">    ColorClip and TextClip.</span>
<span class="sd">    I would have liked to put these in a separate file but Python is bad</span>
<span class="sd">    at cyclic imports.</span>

<span class="sd">---------------------------------------------------------------------&quot;&quot;&quot;</span>


<div class="viewcode-block" id="ImageClip"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.ImageClip.html#moviepy.video.VideoClip.ImageClip">[docs]</a><span class="k">class</span> <span class="nc">ImageClip</span><span class="p">(</span><span class="n">VideoClip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for non-moving VideoClips.</span>

<span class="sd">    A video clip originating from a picture. This clip will simply</span>
<span class="sd">    display the given picture at all times.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; clip = ImageClip(&quot;myHouse.jpeg&quot;)</span>
<span class="sd">    &gt;&gt;&gt; clip = ImageClip( someArray ) # a Numpy array represent</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    img</span>
<span class="sd">      Any picture file (png, tiff, jpeg, etc.) as a string or a path-like object,</span>
<span class="sd">      or any array representing an RGB image (for instance a frame from a VideoClip).</span>

<span class="sd">    is_mask</span>
<span class="sd">      Set this parameter to `True` if the clip is a mask.</span>

<span class="sd">    transparent</span>
<span class="sd">      Set this parameter to `True` (default) if you want the alpha layer</span>
<span class="sd">      of the picture (if it exists) to be used as a mask.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    img</span>
<span class="sd">      Array representing the image of the clip.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fromalpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">VideoClip</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="n">is_mask</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># img is a string or path-like object, so read it in from disk</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">imread_v2</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>  <span class="c1"># We use v2 imread cause v3 fail with gif</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># img is (now) a RGB(a) numpy array</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fromalpha</span><span class="p">:</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">255</span>
                <span class="k">elif</span> <span class="n">is_mask</span><span class="p">:</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">255</span>
                <span class="k">elif</span> <span class="n">transparent</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">ImageClip</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">is_mask</span><span class="p">:</span>
                <span class="n">img</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">255</span>

        <span class="c1"># if the image was just a 2D mask, it should arrive here</span>
        <span class="c1"># unchanged</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">img</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">img</span>

<div class="viewcode-block" id="ImageClip.transform"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.ImageClip.html#moviepy.video.VideoClip.ImageClip.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_duration</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;General transformation filter.</span>

<span class="sd">        Equivalent to VideoClip.transform. The result is no more an</span>
<span class="sd">        ImageClip, it has the class VideoClip (since it may be animated)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">apply_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">apply_to</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># When we use transform on an image clip it may become animated.</span>
        <span class="c1"># Therefore the result is not an ImageClip, just a VideoClip.</span>
        <span class="n">new_clip</span> <span class="o">=</span> <span class="n">VideoClip</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="n">apply_to</span><span class="p">,</span> <span class="n">keep_duration</span><span class="o">=</span><span class="n">keep_duration</span>
        <span class="p">)</span>
        <span class="n">new_clip</span><span class="o">.</span><span class="vm">__class__</span> <span class="o">=</span> <span class="n">VideoClip</span>
        <span class="k">return</span> <span class="n">new_clip</span></div>

<div class="viewcode-block" id="ImageClip.image_transform"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.ImageClip.html#moviepy.video.VideoClip.ImageClip.image_transform">[docs]</a>    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">image_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_func</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Image-transformation filter.</span>

<span class="sd">        Does the same as VideoClip.image_transform, but for ImageClip the</span>
<span class="sd">        transformed clip is computed once and for all at the beginning,</span>
<span class="sd">        and not for each &#39;frame&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">apply_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">apply_to</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">image_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">arr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">arr</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">apply_to</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">image_transform</span><span class="p">(</span><span class="n">image_func</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">new_a</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImageClip.time_transform"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.ImageClip.html#moviepy.video.VideoClip.ImageClip.time_transform">[docs]</a>    <span class="nd">@outplace</span>
    <span class="k">def</span> <span class="nf">time_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_func</span><span class="p">,</span> <span class="n">apply_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_duration</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Time-transformation filter.</span>

<span class="sd">        Applies a transformation to the clip&#39;s timeline</span>
<span class="sd">        (see Clip.time_transform).</span>

<span class="sd">        This method does nothing for ImageClips (but it may affect their</span>
<span class="sd">        masks or their audios). The result is still an ImageClip.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">apply_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">apply_to</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">,</span> <span class="s2">&quot;audio&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">apply_to</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">new_a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">time_transform</span><span class="p">(</span><span class="n">time_func</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">new_a</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ColorClip"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.ColorClip.html#moviepy.video.VideoClip.ColorClip">[docs]</a><span class="k">class</span> <span class="nc">ColorClip</span><span class="p">(</span><span class="n">ImageClip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An ImageClip showing just one color.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    size</span>
<span class="sd">      Size (width, height) in pixels of the clip.</span>

<span class="sd">    color</span>
<span class="sd">      If argument ``is_mask`` is False, ``color`` indicates</span>
<span class="sd">      the color in RGB of the clip (default is black). If `is_mask``</span>
<span class="sd">      is True, ``color`` must be  a float between 0 and 1 (default is 1)</span>

<span class="sd">    is_mask</span>
<span class="sd">      Set to true if the clip will be used as a mask.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">size</span>

        <span class="k">if</span> <span class="n">is_mask</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">color</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Color has to be a scalar when mask is true&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="s2">&quot;__getitem__&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Color has to contain RGB of the clip&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;Color cannot be string. Color has to contain RGB of the clip&quot;</span>
                <span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="n">is_mask</span><span class="o">=</span><span class="n">is_mask</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TextClip"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.TextClip.html#moviepy.video.VideoClip.TextClip">[docs]</a><span class="k">class</span> <span class="nc">TextClip</span><span class="p">(</span><span class="n">ImageClip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for autogenerated text clips.</span>

<span class="sd">    Creates an ImageClip originating from a script-generated text image.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    font</span>
<span class="sd">      Path to the font to use. Must be an OpenType font.</span>

<span class="sd">    text</span>
<span class="sd">      A string of the text to write. Can be replaced by argument</span>
<span class="sd">      ``filename``.</span>

<span class="sd">    filename</span>
<span class="sd">      The name of a file in which there is the text to write,</span>
<span class="sd">      as a string or a path-like object.</span>
<span class="sd">      Can be provided instead of argument ``text``</span>

<span class="sd">    font_size</span>
<span class="sd">      Font size in point. Can be auto-set if method=&#39;caption&#39;,</span>
<span class="sd">      or if method=&#39;label&#39; and size is set.</span>

<span class="sd">    size</span>
<span class="sd">      Size of the picture in pixels. Can be auto-set if</span>
<span class="sd">      method=&#39;label&#39; and font_size is set, but mandatory if method=&#39;caption&#39;.</span>
<span class="sd">      the height can be None for caption if font_size is defined,</span>
<span class="sd">      it will then be auto-determined.</span>

<span class="sd">    margin</span>
<span class="sd">      Margin to be added arround the text as a tuple of two (symmetrical) or</span>
<span class="sd">      four (asymmetrical). Either ``(horizontal, vertical)`` or</span>
<span class="sd">      ``(left, top, right, bottom)``. By default no margin (None, None).</span>
<span class="sd">      This is especially usefull for auto-compute size to give the text some</span>
<span class="sd">      extra room.</span>

<span class="sd">    color</span>
<span class="sd">      Color of the text. Default to &quot;black&quot;. Can be</span>
<span class="sd">      a RGB (or RGBA if transparent = ``True``) ``tuple``, a color name, or an</span>
<span class="sd">      hexadecimal notation.</span>

<span class="sd">    bg_color</span>
<span class="sd">      Color of the background. Default to None for no background. Can be</span>
<span class="sd">      a RGB (or RGBA if transparent = ``True``) ``tuple``, a color name, or an</span>
<span class="sd">      hexadecimal notation.</span>

<span class="sd">    stroke_color</span>
<span class="sd">      Color of the stroke (=contour line) of the text. If ``None``,</span>
<span class="sd">      there will be no stroke.</span>

<span class="sd">    stroke_width</span>
<span class="sd">      Width of the stroke, in pixels. Can be a float, like 1.5.</span>

<span class="sd">    method</span>
<span class="sd">      Either &#39;label&#39; (default, the picture will be autosized so as to fit</span>
<span class="sd">      exactly the size) or &#39;caption&#39; (the text will be drawn in a picture</span>
<span class="sd">      with fixed size provided with the ``size`` argument). If `caption`,</span>
<span class="sd">      the text will be wrapped automagically.</span>

<span class="sd">    text_align</span>
<span class="sd">      center | left | right. Text align similar to css. Default to ``left``.</span>

<span class="sd">    horizontal_align</span>
<span class="sd">      center | left | right. Define horizontal align of text bloc in image.</span>
<span class="sd">      Default to ``center``.</span>

<span class="sd">    vertical_align</span>
<span class="sd">      center | top | bottom. Define vertical align of text bloc in image.</span>
<span class="sd">      Default to ``center``.</span>

<span class="sd">    interline</span>
<span class="sd">      Interline spacing. Default to ``4``.</span>

<span class="sd">    transparent</span>
<span class="sd">      ``True`` (default) if you want to take into account the</span>
<span class="sd">      transparency in the image.</span>

<span class="sd">    duration</span>
<span class="sd">        Duration of the clip</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@convert_path_to_string</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">font</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">font_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">margin</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">bg_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stroke_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">stroke_width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span>
        <span class="n">text_align</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="n">horizontal_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">vertical_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">interline</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
        <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">def</span> <span class="nf">break_text</span><span class="p">(</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="p">,</span> <span class="n">stroke_width</span><span class="p">,</span> <span class="n">align</span><span class="p">,</span> <span class="n">spacing</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Break text to never overflow a width&quot;&quot;&quot;</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">font_pil</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="p">)</span>
            <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
                <span class="n">temp_line</span> <span class="o">=</span> <span class="n">current_line</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">word</span> <span class="k">if</span> <span class="n">current_line</span> <span class="k">else</span> <span class="n">word</span>
                <span class="n">temp_left</span><span class="p">,</span> <span class="n">temp_top</span><span class="p">,</span> <span class="n">temp_right</span><span class="p">,</span> <span class="n">temp_bottom</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">multiline_textbbox</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">temp_line</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="n">font_pil</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span>
                    <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
                    <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">temp_width</span> <span class="o">=</span> <span class="n">temp_right</span> <span class="o">-</span> <span class="n">temp_left</span>

                <span class="k">if</span> <span class="n">temp_width</span> <span class="o">&lt;=</span> <span class="n">width</span><span class="p">:</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="n">temp_line</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="n">word</span>

            <span class="k">if</span> <span class="n">current_line</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">lines</span>

        <span class="k">def</span> <span class="nf">find_text_size</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="n">font</span><span class="p">,</span>
            <span class="n">font_size</span><span class="p">,</span>
            <span class="n">stroke_width</span><span class="p">,</span>
            <span class="n">align</span><span class="p">,</span>
            <span class="n">spacing</span><span class="p">,</span>
            <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">allow_break</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Find dimensions a text will occupy, return a tuple (width, height)&quot;&quot;&quot;</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">font_pil</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="p">)</span>
            <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">max_width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">allow_break</span><span class="p">:</span>
                <span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">multiline_textbbox</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">text</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="n">font_pil</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span>
                    <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
                    <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="n">left</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span><span class="p">))</span>

            <span class="n">lines</span> <span class="o">=</span> <span class="n">break_text</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
                <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span>
                <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
                <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">multiline_textbbox</span><span class="p">(</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span>
                <span class="n">font</span><span class="o">=</span><span class="n">font_pil</span><span class="p">,</span>
                <span class="n">spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span>
                <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
                <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">right</span> <span class="o">-</span> <span class="n">left</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">find_optimum_font_size</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span>
            <span class="n">font</span><span class="p">,</span>
            <span class="n">stroke_width</span><span class="p">,</span>
            <span class="n">align</span><span class="p">,</span>
            <span class="n">spacing</span><span class="p">,</span>
            <span class="n">width</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">allow_break</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Find the best font size to fit as optimally as possible&quot;&quot;&quot;</span>
            <span class="n">max_font_size</span> <span class="o">=</span> <span class="n">width</span>
            <span class="n">min_font_size</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Try find best size using bisection</span>
            <span class="k">while</span> <span class="n">min_font_size</span> <span class="o">&lt;</span> <span class="n">max_font_size</span><span class="p">:</span>
                <span class="n">avg_font_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_font_size</span> <span class="o">+</span> <span class="n">min_font_size</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">text_width</span><span class="p">,</span> <span class="n">text_height</span> <span class="o">=</span> <span class="n">find_text_size</span><span class="p">(</span>
                    <span class="n">text</span><span class="p">,</span>
                    <span class="n">font</span><span class="p">,</span>
                    <span class="n">avg_font_size</span><span class="p">,</span>
                    <span class="n">stroke_width</span><span class="p">,</span>
                    <span class="n">align</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="p">,</span>
                    <span class="n">max_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                    <span class="n">allow_break</span><span class="o">=</span><span class="n">allow_break</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">text_width</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="ow">and</span> <span class="p">(</span><span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">text_height</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">):</span>
                    <span class="n">min_font_size</span> <span class="o">=</span> <span class="n">avg_font_size</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">max_font_size</span> <span class="o">=</span> <span class="n">avg_font_size</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="c1"># Check if the last font size tested fits within the given width and height</span>
            <span class="n">text_width</span><span class="p">,</span> <span class="n">text_height</span> <span class="o">=</span> <span class="n">find_text_size</span><span class="p">(</span>
                <span class="n">text</span><span class="p">,</span>
                <span class="n">font</span><span class="p">,</span>
                <span class="n">min_font_size</span><span class="p">,</span>
                <span class="n">stroke_width</span><span class="p">,</span>
                <span class="n">align</span><span class="p">,</span>
                <span class="n">spacing</span><span class="p">,</span>
                <span class="n">max_width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">allow_break</span><span class="o">=</span><span class="n">allow_break</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">text_width</span> <span class="o">&lt;=</span> <span class="n">width</span> <span class="ow">and</span> <span class="p">(</span><span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">text_height</span> <span class="o">&lt;=</span> <span class="n">height</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">min_font_size</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">min_font_size</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid font </span><span class="si">{}</span><span class="s2">, pillow failed to use it with error </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>  <span class="c1"># Remove newline at end</span>

        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No text nor filename provided&quot;</span><span class="p">)</span>

        <span class="c1"># Compute all img and text sizes if some are missing</span>
        <span class="n">img_width</span><span class="p">,</span> <span class="n">img_height</span> <span class="o">=</span> <span class="n">size</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;caption&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">img_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Size is mandatory when method is caption&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">img_height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">font_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Height is mandatory when method is caption and font size is None&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">font_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">font_size</span> <span class="o">=</span> <span class="n">find_optimum_font_size</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
                    <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                    <span class="n">align</span><span class="o">=</span><span class="n">text_align</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="o">=</span><span class="n">interline</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">img_width</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">img_height</span><span class="p">,</span>
                    <span class="n">allow_break</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">img_height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">img_height</span> <span class="o">=</span> <span class="n">find_text_size</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
                    <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span>
                    <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                    <span class="n">align</span><span class="o">=</span><span class="n">text_align</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="o">=</span><span class="n">interline</span><span class="p">,</span>
                    <span class="n">max_width</span><span class="o">=</span><span class="n">img_width</span><span class="p">,</span>
                    <span class="n">allow_break</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Add line breaks whenever needed</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">break_text</span><span class="p">(</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">img_width</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
                    <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span>
                    <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                    <span class="n">align</span><span class="o">=</span><span class="n">text_align</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="o">=</span><span class="n">interline</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">font_size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">img_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Font size is mandatory when method is label and size is None&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">font_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">font_size</span> <span class="o">=</span> <span class="n">find_optimum_font_size</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
                    <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                    <span class="n">align</span><span class="o">=</span><span class="n">text_align</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="o">=</span><span class="n">interline</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">img_width</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">img_height</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">img_width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">img_width</span> <span class="o">=</span> <span class="n">find_text_size</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
                    <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span>
                    <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                    <span class="n">align</span><span class="o">=</span><span class="n">text_align</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="o">=</span><span class="n">interline</span><span class="p">,</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">img_height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">img_height</span> <span class="o">=</span> <span class="n">find_text_size</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
                    <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span>
                    <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
                    <span class="n">align</span><span class="o">=</span><span class="n">text_align</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="o">=</span><span class="n">interline</span><span class="p">,</span>
                    <span class="n">max_width</span><span class="o">=</span><span class="n">img_width</span><span class="p">,</span>
                <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Method must be either `caption` or `label`.&quot;</span><span class="p">)</span>

        <span class="c1"># Compute the margin and apply it</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">margin</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">left_margin</span> <span class="o">=</span> <span class="n">right_margin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">margin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">top_margin</span> <span class="o">=</span> <span class="n">bottom_margin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">margin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">margin</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">left_margin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">margin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">top_margin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">margin</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">right_margin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">margin</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">bottom_margin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">margin</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Margin must be a tuple of either 2 or 4 elements.&quot;</span><span class="p">)</span>

        <span class="n">img_width</span> <span class="o">+=</span> <span class="n">left_margin</span> <span class="o">+</span> <span class="n">right_margin</span>
        <span class="n">img_height</span> <span class="o">+=</span> <span class="n">top_margin</span> <span class="o">+</span> <span class="n">bottom_margin</span>

        <span class="c1"># Trace the image</span>
        <span class="n">img_mode</span> <span class="o">=</span> <span class="s2">&quot;RGBA&quot;</span> <span class="k">if</span> <span class="n">transparent</span> <span class="k">else</span> <span class="s2">&quot;RGB&quot;</span>

        <span class="k">if</span> <span class="n">bg_color</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transparent</span><span class="p">:</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">img_mode</span><span class="p">,</span> <span class="p">(</span><span class="n">img_width</span><span class="p">,</span> <span class="n">img_height</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="n">pil_font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="p">)</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="c1"># Dont need allow break here, because we already breaked in caption</span>
        <span class="n">text_width</span><span class="p">,</span> <span class="n">text_height</span> <span class="o">=</span> <span class="n">find_text_size</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
            <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span>
            <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
            <span class="n">align</span><span class="o">=</span><span class="n">text_align</span><span class="p">,</span>
            <span class="n">spacing</span><span class="o">=</span><span class="n">interline</span><span class="p">,</span>
            <span class="n">max_width</span><span class="o">=</span><span class="n">img_width</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">horizontal_align</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">img_width</span> <span class="o">-</span> <span class="n">text_width</span> <span class="o">-</span> <span class="n">left_margin</span> <span class="o">-</span> <span class="n">right_margin</span>
        <span class="k">elif</span> <span class="n">horizontal_align</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">img_width</span> <span class="o">-</span> <span class="n">left_margin</span> <span class="o">-</span> <span class="n">right_margin</span> <span class="o">-</span> <span class="n">text_width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">x</span> <span class="o">+=</span> <span class="n">left_margin</span>

        <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">vertical_align</span> <span class="o">==</span> <span class="s2">&quot;bottom&quot;</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">img_height</span> <span class="o">-</span> <span class="n">text_height</span> <span class="o">-</span> <span class="n">top_margin</span> <span class="o">-</span> <span class="n">bottom_margin</span>
        <span class="k">elif</span> <span class="n">vertical_align</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">img_height</span> <span class="o">-</span> <span class="n">top_margin</span> <span class="o">-</span> <span class="n">bottom_margin</span> <span class="o">-</span> <span class="n">text_height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">y</span> <span class="o">+=</span> <span class="n">top_margin</span>

        <span class="c1"># So, pillow multiline support is horrible, in particular multiline_text</span>
        <span class="c1"># and multiline_textbbox are not intuitive at all. They cannot use left</span>
        <span class="c1"># top (see https://pillow.readthedocs.io/en/stable/handbook/text-anchors.html)</span>
        <span class="c1"># as anchor, so we always have to use left middle instead. Else we would</span>
        <span class="c1"># always have a useless margin (the diff between ascender and top) on any</span>
        <span class="c1"># text. That mean our Y is actually not from 0 for top, but need to be</span>
        <span class="c1"># increment by half our text height, since we have to reference from</span>
        <span class="c1"># middle line.</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">text_height</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">draw</span><span class="o">.</span><span class="n">multiline_text</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="n">pil_font</span><span class="p">,</span>
            <span class="n">spacing</span><span class="o">=</span><span class="n">interline</span><span class="p">,</span>
            <span class="n">align</span><span class="o">=</span><span class="n">text_align</span><span class="p">,</span>
            <span class="n">stroke_width</span><span class="o">=</span><span class="n">stroke_width</span><span class="p">,</span>
            <span class="n">stroke_fill</span><span class="o">=</span><span class="n">stroke_color</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># We just need the image as a numpy array</span>
        <span class="n">img_numpy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

        <span class="n">ImageClip</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">img_numpy</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="n">transparent</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_color</span> <span class="o">=</span> <span class="n">stroke_color</span></div>


<div class="viewcode-block" id="BitmapClip"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.BitmapClip.html#moviepy.video.VideoClip.BitmapClip">[docs]</a><span class="k">class</span> <span class="nc">BitmapClip</span><span class="p">(</span><span class="n">VideoClip</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clip made of color bitmaps. Mainly designed for testing purposes.&quot;&quot;&quot;</span>

    <span class="n">DEFAULT_COLOR_DICT</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
        <span class="s2">&quot;O&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
        <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">89</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">62</span><span class="p">),</span>
        <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">113</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span>
        <span class="s2">&quot;D&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">215</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">143</span><span class="p">),</span>
        <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">57</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span>
        <span class="s2">&quot;F&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">33</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="nd">@convert_parameter_to_seconds</span><span class="p">([</span><span class="s2">&quot;duration&quot;</span><span class="p">])</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bitmap_frames</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">is_mask</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a VideoClip object from a bitmap representation. Primarily used</span>
<span class="sd">        in the test suite.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        bitmap_frames</span>
<span class="sd">          A list of frames. Each frame is a list of strings. Each string</span>
<span class="sd">          represents a row of colors. Each color represents an (r, g, b) tuple.</span>
<span class="sd">          Example input (2 frames, 5x3 pixel size)::</span>

<span class="sd">              [[&quot;RRRRR&quot;,</span>
<span class="sd">                &quot;RRBRR&quot;,</span>
<span class="sd">                &quot;RRBRR&quot;],</span>
<span class="sd">               [&quot;RGGGR&quot;,</span>
<span class="sd">                &quot;RGGGR&quot;,</span>
<span class="sd">                &quot;RGGGR&quot;]]</span>

<span class="sd">        fps</span>
<span class="sd">          The number of frames per second to display the clip at. `duration` will</span>
<span class="sd">          calculated from the total number of frames. If both `fps` and `duration`</span>
<span class="sd">          are set, `duration` will be ignored.</span>

<span class="sd">        duration</span>
<span class="sd">          The total duration of the clip. `fps` will be calculated from the total</span>
<span class="sd">          number of frames. If both `fps` and `duration` are set, `duration` will</span>
<span class="sd">          be ignored.</span>

<span class="sd">        color_dict</span>
<span class="sd">          A dictionary that can be used to set specific (r, g, b) values that</span>
<span class="sd">          correspond to the letters used in ``bitmap_frames``.</span>
<span class="sd">          eg ``{&quot;A&quot;: (50, 150, 150)}``.</span>

<span class="sd">          Defaults to::</span>

<span class="sd">              {</span>
<span class="sd">                &quot;R&quot;: (255, 0, 0),</span>
<span class="sd">                &quot;G&quot;: (0, 255, 0),</span>
<span class="sd">                &quot;B&quot;: (0, 0, 255),</span>
<span class="sd">                &quot;O&quot;: (0, 0, 0),  # &quot;O&quot; represents black</span>
<span class="sd">                &quot;W&quot;: (255, 255, 255),</span>
<span class="sd">                # &quot;A&quot;, &quot;C&quot;, &quot;D&quot;, &quot;E&quot;, &quot;F&quot; represent arbitrary colors</span>
<span class="sd">                &quot;A&quot;: (89, 225, 62),</span>
<span class="sd">                &quot;C&quot;: (113, 157, 108),</span>
<span class="sd">                &quot;D&quot;: (215, 182, 143),</span>
<span class="sd">                &quot;E&quot;: (57, 26, 252),</span>
<span class="sd">              }</span>

<span class="sd">        is_mask</span>
<span class="sd">          Set to ``True`` if the clip is going to be used as a mask.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">fps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">duration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">color_dict</span> <span class="o">=</span> <span class="n">color_dict</span> <span class="k">if</span> <span class="n">color_dict</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_COLOR_DICT</span>

        <span class="n">frame_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">input_frame</span> <span class="ow">in</span> <span class="n">bitmap_frames</span><span class="p">:</span>
            <span class="n">output_frame</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">input_frame</span><span class="p">:</span>
                <span class="n">output_frame</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">color_dict</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">row</span><span class="p">])</span>
            <span class="n">frame_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">output_frame</span><span class="p">))</span>

        <span class="n">frame_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frame_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_frames</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame_array</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_frames</span> <span class="o">/</span> <span class="n">duration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_frames</span> <span class="o">/</span> <span class="n">fps</span>

        <span class="n">VideoClip</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">frame_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">frame_array</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)],</span>
            <span class="n">is_mask</span><span class="o">=</span><span class="n">is_mask</span><span class="p">,</span>
            <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fps</span> <span class="o">=</span> <span class="n">fps</span>

<div class="viewcode-block" id="BitmapClip.to_bitmap"><a class="viewcode-back" href="../../../reference/reference/moviepy.video.VideoClip.BitmapClip.html#moviepy.video.VideoClip.BitmapClip.to_bitmap">[docs]</a>    <span class="k">def</span> <span class="nf">to_bitmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a valid bitmap list that represents each frame of the clip.</span>
<span class="sd">        If `color_dict` is not specified, then it will use the same `color_dict`</span>
<span class="sd">        that was used to create the clip.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">color_dict</span> <span class="o">=</span> <span class="n">color_dict</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_dict</span>

        <span class="n">bitmap</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_frames</span><span class="p">():</span>
            <span class="n">bitmap</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">frame</span><span class="p">:</span>
                <span class="n">bitmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">pixel</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">letter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">color_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span>
                        <span class="nb">list</span><span class="p">(</span><span class="n">color_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pixel</span><span class="p">))</span>
                    <span class="p">]</span>
                    <span class="n">bitmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">letter</span>

        <span class="k">return</span> <span class="n">bitmap</span></div></div>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner"></div>
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
       Copyright 2024, Zulko - MIT.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>